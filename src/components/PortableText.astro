---
import { urlFor } from '../lib/sanity';

interface Props {
  value: any[];
}

const { value } = Astro.props;

function renderBlock(block: any) {
  if (block._type === 'block') {
    const style = block.style || 'normal';
    const children = block.children?.map((child: any) => {
      let text = child.text || '';
      if (child.marks) {
        child.marks.forEach((mark: string) => {
          if (mark === 'strong') text = `<strong>${text}</strong>`;
          if (mark === 'em') text = `<em>${text}</em>`;
          if (mark === 'underline') text = `<u>${text}</u>`;
        });
      }
      return text;
    }).join('');

    switch (style) {
      case 'h2':
        return `<h2>${children}</h2>`;
      case 'h3':
        return `<h3>${children}</h3>`;
      case 'h4':
        return `<h4>${children}</h4>`;
      case 'blockquote':
        return `<blockquote>${children}</blockquote>`;
      default:
        return `<p>${children}</p>`;
    }
  }

  if (block._type === 'image' && block.asset) {
    const url = urlFor(block).width(800).url();
    return `<img src="${url}" alt="${block.alt || ''}" class="rounded-lg my-6" />`;
  }

  return '';
}
---

<div class="prose prose-lg max-w-none">
  {value?.map((block) => (
    <Fragment set:html={renderBlock(block)} />
  ))}
</div>
