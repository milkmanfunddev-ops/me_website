---
import { getSiteSettings, urlFor } from '../lib/sanity';

const siteSettings = await getSiteSettings();
const currentYear = new Date().getFullYear();

// Fallback values
const siteName = siteSettings?.siteName || 'Mealvana Endurance';
const footerDescription = siteSettings?.footerDescription || 'Personalized nutrition plans for endurance athletes. Science-backed meal planning tailored to your training, your body, and your goals.';
const logoUrl = siteSettings?.logo ? urlFor(siteSettings.logo).width(80).url() : '/images/app-icon.png';

// Default footer links if not set in Sanity
const defaultQuickLinks = [
  { label: 'Home', href: '/' },
  { label: 'Blog', href: '/blog' },
  { label: "What's New", href: '/whats-new' },
  { label: 'Support', href: '/support' },
];

const defaultLegalLinks = [
  { label: 'Privacy Policy', href: '/privacy-policy' },
  { label: 'Terms of Use', href: '/terms' },
  { label: 'Contact Us', href: 'mailto:support@mealvana.io' },
];

// Use Sanity footer links for Quick Links, fallback to defaults
const quickLinks = siteSettings?.footerLinks?.length > 0 ? siteSettings.footerLinks : defaultQuickLinks;
---

<footer class="bg-blackberry text-text-light">
  <div class="max-w-6xl mx-auto px-6 py-16">
    <div class="grid md:grid-cols-4 gap-8">
      <!-- Brand -->
      <div class="md:col-span-2">
        <div class="flex items-center gap-3 mb-4">
          <img src={logoUrl} alt={siteName} class="w-10 h-10 rounded-lg" />
          <h3 class="font-sansita text-2xl font-bold">{siteName}</h3>
        </div>
        <p class="text-text-light/70 max-w-md mb-6">
          {footerDescription}
        </p>
        <a
          href="https://testflight.apple.com/join/1HJG86nz"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block"
        >
          <img
            src="/images/appstore.png"
            alt="Download on TestFlight"
            class="h-10 hover:opacity-90 transition-opacity"
          />
        </a>
      </div>

      <!-- Quick Links -->
      <div>
        <h4 class="font-sansita text-lg font-bold mb-4">Quick Links</h4>
        <ul class="space-y-2">
          {quickLinks.map((link: { label: string; href: string }) => (
            <li>
              <a href={link.href} class="text-text-light/70 hover:text-text-light transition-colors">
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </div>

      <!-- Legal -->
      <div>
        <h4 class="font-sansita text-lg font-bold mb-4">Legal</h4>
        <ul class="space-y-2">
          {defaultLegalLinks.map((link) => (
            <li>
              <a href={link.href} class="text-text-light/70 hover:text-text-light transition-colors">
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>

    <div class="border-t border-text-light/10 mt-12 pt-8 text-center text-text-light/50 text-sm">
      <p>&copy; {currentYear} Milkman Inc. All rights reserved.</p>
    </div>
  </div>
</footer>
